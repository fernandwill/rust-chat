<!DOCTYPE html>
<html>
<head>
  <title>WebSocket Chat</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #chat { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin: 10px 0; }
    #msg { width: 300px; padding: 5px; }
    button { padding: 5px 10px; }
    .status { color: #666; font-style: italic; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h1>WebSocket Chat</h1>
  <div id="status" class="status">Connecting...</div>
  <input id="msg" placeholder="Type a message..." disabled />
  <button id="sendBtn" onclick="sendMessage()" disabled>Send</button>
  <button onclick="disconnect()">Disconnect</button>
  <div id="chat"></div>

  <script>
    let ws = null;
    let isConnected = false;

    function connect() {
      ws = new WebSocket("ws://127.0.0.1:8080");

      ws.onopen = (event) => {
        console.log("WebSocket connection opened");
        document.getElementById("status").innerHTML = '<span class="success">âœ… Connected</span>';
        document.getElementById("msg").disabled = false;
        document.getElementById("sendBtn").disabled = false;
        isConnected = true;
        addMessage("Connected to server", "status");
      };

      ws.onmessage = (event) => {
        console.log("Received message:", event.data);
        addMessage("Server: " + event.data, "message");
      };

      ws.onclose = (event) => {
        console.log("WebSocket connection closed:", event.code, event.reason);
        document.getElementById("status").innerHTML = '<span class="error">ðŸ”Œ Disconnected</span>';
        document.getElementById("msg").disabled = true;
        document.getElementById("sendBtn").disabled = true;
        isConnected = false;
        addMessage(`Connection closed (Code: ${event.code})`, "status");
      };

      ws.onerror = (event) => {
        console.error("WebSocket error:", event);
        addMessage("Connection error occurred", "error");
      };
    }

    function sendMessage() {
      const input = document.getElementById("msg");
      const message = input.value.trim();
      
      if (message && isConnected) {
        ws.send(message);
        addMessage("You: " + message, "message");
        input.value = "";
      }
    }

    function disconnect() {
      if (ws && isConnected) {
        ws.close(1000, "User disconnected");
      }
    }

    function addMessage(text, type) {
      const chat = document.getElementById("chat");
      const msg = document.createElement("p");
      msg.textContent = text;
      msg.className = type;
      chat.appendChild(msg);
      chat.scrollTop = chat.scrollHeight;
    }

    // Allow sending message with Enter key
    document.getElementById("msg").addEventListener("keypress", function(event) {
      if (event.key === "Enter") {
        sendMessage();
      }
    });

    // Connect when page loads
    connect();
  </script>
</body>
</html>